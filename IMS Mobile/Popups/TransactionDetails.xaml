<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup
    x:Class="IMS_Mobile.Popups.TransactionDetails"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:Converters="clr-namespace:IMS_Mobile.Converters"
    xmlns:Models="clr-namespace:IMS_Mobile.MVVM.Models"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Margin="0"
    Padding="0"
    BackgroundColor="White"
    CanBeDismissedByTappingOutsideOfPopup="True"
    HeightRequest="600">

    <Grid
        Margin="0"
        Padding="0"
        RowDefinitions="Auto,Auto,*,Auto"
        RowSpacing="5">
        <!--  Header  -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
            <VerticalStackLayout Grid.Column="0" Spacing="4">
                <Label StyleClass="SectionTitleStyle" Text="Transaction Details" />
                <Label
                    Margin="20,0,0,0"
                    StyleClass="SmallTextStyle"
                    Text="View all products in this transaction" />
            </VerticalStackLayout>

            <Button
                Grid.Column="1"
                Margin="0,10,10,0"
                BackgroundColor="Transparent"
                Clicked="OnCloseClicked"
                FontSize="20"
                HeightRequest="40"
                Text="âœ•"
                TextColor="Gray"
                VerticalOptions="Start"
                WidthRequest="40" />
        </Grid>

        <!--  Divider  -->
        <BoxView
            Grid.Row="1"
            BackgroundColor="#E0E0E0"
            HeightRequest="1" />

        <!--  Products List  -->
        <CollectionView
            Grid.Row="2"
            ItemsSource="{Binding Products}"
            VerticalScrollBarVisibility="Always">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" Span="1" />
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border StyleClass="TransactionCardStyle">
                        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">
                            <!--  Product Image  -->
                            <Border
                                Grid.RowSpan="2"
                                Grid.Column="0"
                                Margin="0,0,12,0"
                                HeightRequest="60"
                                StyleClass="TransactionIconStyle"
                                WidthRequest="60">
                                <Image
                                    Aspect="AspectFill"
                                    HorizontalOptions="Center"
                                    Source="product.png"
                                    VerticalOptions="Center" />
                            </Border>

                            <!--  Product Details  -->
                            <VerticalStackLayout
                                Grid.Row="0"
                                Grid.Column="1"
                                Spacing="4">
                                <Label
                                    FontFamily="poppinbold"
                                    FontSize="16"
                                    Text="{Binding Name}"
                                    TextColor="Black" />
                                <Label StyleClass="SmallTextStyle" Text="{Binding TotalPrice, StringFormat='{0} LBP'}" />
                            </VerticalStackLayout>

                            <!--  Quantity  -->
                            <Label
                                Grid.Row="1"
                                Grid.Column="1"
                                StyleClass="SmallTextStyle"
                                Text="{Binding Quantity, StringFormat='{0} units'}"
                                VerticalOptions="End" />

                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!--  Footer  -->
        <Border
            Grid.Row="3"
            Padding="16,12"
            BackgroundColor="#F8F9FA"
            StrokeShape="RoundRectangle 8"
            StrokeThickness="0">
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                <Label
                    FontSize="16"
                    Text="ðŸ“¦"
                    VerticalOptions="Center" />
                <Label
                    StyleClass="RegularTextStyle"
                    Text="{Binding Products.Count, StringFormat='{0} products'}"
                    VerticalOptions="Center" />
            </HorizontalStackLayout>
        </Border>
    </Grid>

</toolkit:Popup>